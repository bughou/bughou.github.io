<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>腾讯面试 | bughou的笔记</title>



<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://bughou.github.io/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://bughou.github.io/blog/interview/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://bughou.github.io">
          <h1 class="title is-4">bughou的笔记</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    <h2 class="subtitle is-6">December 20, 2017</h2>
    <h1 class="title">腾讯面试</h1>
    
    <div class="content">
      

<p>昨晚面试，暴露了我的一个问题，浮于表面，对基础概念的实现完全没有深入研究。 记录一下面试过程：</p>

<h1 id="1-跳槽多">1. 跳槽多</h1>

<p>面试官坐下来，看我的简历，就说你呆过的公司挺多啊。让我解释一下为啥换了这多公司。于是我开始一家一家的解释离职原因。面试官也没说啥。现在想起来，我应该总结一下，到目前为止呆过5家公司，第一次辞职是上海回成都，第二次是因为自己创业，第三次是因为被朋友挖走了，第四次是因为公司高层斗争不发工资了。</p>

<h1 id="2-atoi实现">2. atoi实现</h1>

<p>我说比较了解C，C相对C++简单很多。面试官说那你用C实现一下字符串转整数。正下笔的时候，发现C的函数定义是怎么样的都想不起来了，窘得不行。赶紧说好多年没写过C、语法都忘了，说用golang实现吧，面试官同意了。开始用golang实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">atoi</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">result</span> <span style="color:#66d9ef">int</span>) {
  <span style="color:#a6e22e">d</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">s</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
    <span style="color:#a6e22e">d</span> <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>
    <span style="color:#a6e22e">result</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">s</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">d</span>
  }
  <span style="color:#66d9ef">return</span>
}</code></pre></div>
<p>在写完也没检查立即就给面试官了，纸上字迹比较潦草，就给面试官解说我的思路。正准备说思路，发现不对啊，立即给面试官说，这里不对，应该是从右向左遍历，于是改成下面这样：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">atoi</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">result</span> <span style="color:#66d9ef">int</span>) {
  <span style="color:#a6e22e">d</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
  <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">s</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
    <span style="color:#a6e22e">d</span> <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>
    <span style="color:#a6e22e">result</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">s</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">d</span>
  }
  <span style="color:#66d9ef">return</span>
}</code></pre></div>
<p>着急忙荒的i++也忘了改成i&ndash;了。开始解释我的思路，面试官也没说啥，就说用Golang确实比用C简单很多，然后我说就这个功能来说用golang和用C，应该是一样的，没啥区别，他说C语言里你怎么遍历字符串，我一下想起来，这里取字符串长度用了len，而C没有这个内置方法，确实golang省事不少。后来回去的路上，突然想起来，不对啊， d *= 10 应该放在循环体的末尾啊，也不知道面试官看出来没有。现在想来，这实现还是有很大问题啊，完全没有错误处理啊。面试的时候想的都是赶紧做完，太仓促了，很多都没考虑到，平时写代码肯定不会忘记错误处理。或许面试官也看出这些问题了，只是没指出来而已，默默在心里做了减分吧。</p>

<p>补充，还有个问题：<code>s[i] * d</code> 也忘了减掉 <code>'0'</code>了，应该是<code>(s[i]-'0') * d</code>啊。下午用C重新实现了一遍：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">Atoi</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> s[]) {
  <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, negative <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">if</span> (s <span style="color:#f92672">!=</span> NULL) {
    <span style="color:#66d9ef">switch</span> (s[<span style="color:#ae81ff">0</span>]) {
      <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">:</span> s<span style="color:#f92672">++</span>; <span style="color:#66d9ef">break</span>;
      <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">:</span> negative <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; s<span style="color:#f92672">++</span>; <span style="color:#66d9ef">break</span>;
    }
    <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">int</span> d <span style="color:#f92672">=</span> s[len] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>;
      <span style="color:#66d9ef">if</span> (d <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> d <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">9</span>) len<span style="color:#f92672">++</span>;
      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">break</span>;
    }
  }

  <span style="color:#66d9ef">int</span> result <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, base <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; i<span style="color:#f92672">--</span>) {
    result <span style="color:#f92672">+=</span> (s[i] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> base;
    base <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>;
  }

  <span style="color:#66d9ef">if</span> (negative) {
    result <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>result;
  }

  <span style="color:#66d9ef">return</span> result;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#66d9ef">char</span><span style="color:#f92672">*</span> s[] <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;123&#34;</span>,  <span style="color:#e6db74">&#34;+123&#34;</span>, <span style="color:#e6db74">&#34;-123&#34;</span>, <span style="color:#e6db74">&#34;123a4&#34;</span>, <span style="color:#e6db74">&#34;+123a4&#34;</span>, <span style="color:#e6db74">&#34;-123a4&#34;</span>, NULL };
  <span style="color:#66d9ef">int</span> failed <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; s[i] <span style="color:#f92672">!=</span> NULL; i<span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">int</span> expect <span style="color:#f92672">=</span> atoi(s[i]);
    <span style="color:#66d9ef">int</span> got    <span style="color:#f92672">=</span> Atoi(s[i]);
    <span style="color:#66d9ef">if</span> (got <span style="color:#f92672">!=</span> expect) {
      printf(<span style="color:#e6db74">&#34;input: %s, expect: %d, got: %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, s[i], expect, got);
      failed<span style="color:#f92672">++</span>;
    }
  }
  <span style="color:#66d9ef">if</span> (failed <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
    printf(<span style="color:#e6db74">&#34;all tests passed.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
  }
}</code></pre></div>
<h1 id="3-golang-channel的实现">3. golang channel的实现</h1>

<p>面试官问channel是怎样实现的，之前在网上搜了过，大致看了一下，链表+锁，就没深入研究了。我说链表+锁，然后开始扯&rdquo;Don&rsquo;t communicate by sharing memory; share memory by communicating&rdquo;这句话的误导性，不要一味的用channel，因为channel也是加锁实现的，channel和锁应该是哪个用起来简单直观，就用哪个。还把share memory说成了share information。</p>

<p>然后面试官问channel的阻塞是怎么实现的。我不知道啊，看channel实现的时候，忘记了看阻塞了，这么重要的。我说不知道，又开始扯网络操作的阻塞是通过epoll实现的。回去后看了channel的实现代码，channel的阻塞，其实是阻塞所在的goroutine，这个原理我是知道的啊，不光是channel，sleep、网络IO也都是通过阻塞所在的goroutine来实现的。但是从来没有对channel的阻塞这么想过，突然被问道，就反应不过来。</p>

<p>面试官又问哪个系统调用能实现和channel类似的效果，想了想，然后说不知道。回去的路上想起来面试官想问的莫非是管道（pipe）。记得刚开始接触的golang的时候，确实有把这两个做类比，现在用久了，都没有把这两者联系在一起过了。</p>

<h1 id="4-make-非make-两种初始化的区别">4. make、非make 两种初始化的区别</h1>

<p>然后面试官问，map的make初始化、非make形式的初始化的区别。我一想说make形式的在堆上？非make形式的在栈上？面试官说是否在栈上也要看值得大小吧。我就说不知道了，平时都是看着哪个顺手就用哪个的。回去的路上想，make可以传capacity hint啊，莫非是想问这个区别？</p>

<h1 id="5-聊做过的项目">5. 聊做过的项目</h1>

<p>然后面试官估计有点失望了，问我“你项目经历还挺多的，是不是一直在做业务，没有做过底层啊？”，我一想，是啊，没做过底层项目啊，就说是的。然后一想不对，我最近不是做了框架吗？赶紧说最近做了个框架。面试官问为啥要自己做，应该是已经有挺好用的开源的了吧？然后我就解释了http标准库没有正则支持、不直观，beego的风格不喜欢，个人喜欢express风格。然后解释了我们框架中基于map的路由比常见的基于数组的路由更优化、还有更直观的模板渲染等。然后面试官说他们和我们不一样，用的路由很简单。</p>

<p>然后我说框架自带了ELK日志收集等功能，面试官就问为啥要自己写logc日志收集，我就说首先是自己喜欢造轮子，还有当初对logstash基于轮询的日志收集不满意，再加上觉得自己做也很简单，所以就自己做了。面试官说fluentd也是基于轮询的吗，我说fluentd不是基于轮询的，但是我们知道fluentd的时候，logc已经写了一大半了。面试官说如果是他，他会给logstash之类的写一个插件，也不会自己写完整的日志收集。我说都已经有zookeeper了，go社区不是还是实现了自己的etcd吗？如果对一个东西感兴趣，想自己写，就勇敢动手自己写，至少也是一种成长嘛。面试官略表同意。 回来的路上想，其实还有两个重要的原因，一是logstash依赖java，fluentd依赖ruby，我们不想在我们的docker镜像里加入这两个运行时依赖。还有就是当时不太满意kibana没有权限控制，打算自己实现一个基于elasticSearch的日志可视化和监控系统，所以想日志收集也自己写，有更多的控制，方便监控报警等实现。后来kibana用的多了，发现elasticSearch有watch、alerts等功能，慢慢就放弃自己实现日志可视化和监控的想法了。</p>

<p>然后给面试官说框架实现了基于docker的部署，面试官问日志收集容器是怎么访问到其他容器的日志的。我就说了volume在多个容器间共享存储。</p>

<h1 id="6-结束">6. 结束</h1>

<p>然后面试官就让我回去了。说给领导汇报一下，或者让华仔通知我面试结果。下楼来看，才7点三十多，7点过几分上楼的，还等了会儿，所以面试过程估计也就二十分钟的样子。</p>

<h1 id="总结">总结</h1>

<p>上一次面试，还是四年前了。以前的面试也都是问一些各种用法，从来没有被问过底层原理和实现。自己对底层实现没足够了解，浮于表面，所以面试肯定是非常被动的。长期目标：花时间吃透底层实现，让自己更有底气些。</p>

      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/bughou">bughou</a> 2017</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>



</body>
</html>

